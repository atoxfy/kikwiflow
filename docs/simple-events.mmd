sequenceDiagram
    participant VThread_A as "Thread Executora da Tarefa<br>(Virtual Thread)"
    participant TaskExecutorService as "TaskExecutorService"
    participant EventPublisher as "EventPublisher"
    participant SharedExecutor as "Executor Partilhado<br>(para Listeners)"

    VThread_A ->>+ TaskExecutorService: execute(tarefa)
    Note right of TaskExecutorService: Lógica do JavaDelegate é executada aqui...
    TaskExecutorService ->>+ EventPublisher: publishEvent(TaskCompletedEvent)

    Note right of EventPublisher: A thread principal NÃO espera.

    par "Notificação Assíncrona dos Listeners"
        EventPublisher ->> SharedExecutor: submit(historyListener.onEvent)
    and
        EventPublisher ->> SharedExecutor: submit(kafkaListener.onEvent)
    end

    EventPublisher -->>- TaskExecutorService: Retorna Imediatamente
    TaskExecutorService -->>- VThread_A: Retorna

    VThread_A ->> VThread_A: Continua para o próximo passo (chama o Navigator, etc.)

    Note over SharedExecutor: O Executor Partilhado lança novas<br>threads virtuais para cada listener.

